# Storage
Similar to Docker, container orchestration tools, such as Kubernetes, have several storage options and functionality.

## Docker
Docker stores its files in the `/var/lib/docker` path. There are subdirectories that store containers, images, volumes, etc.


### Layered Architecture
Docker uses a <span style = "color:lightblue">layered architecture</span> to build its images, where each line in a Dockerfile corresponds to a new layer. Thus, images with the same layers could be built more quickly and efficiently, as Docker will use the pre-built layers from cache.

```Dockerfile
FROM ubuntu

RUN apt-get update for && apt-get -y install python

RUN pip install flask flask-mysql

COPY . /app/src

ENTRYPOINT FLASK_APP=/app/src/app.py flask run
```

```Dockerfile
FROM ubuntu

RUN apt-get update for && apt-get -y install python

RUN pip install flask flask-mysql

COPY app2.py /app/src

ENTRYPOINT FLASK_APP=/app/src/app2.py flask run
```

In the above Dockerfiles, since the first three lines are identical, their layers can be reused. This saves time during the `build` command and saves storage space. Layers (*the Docker image*) created during building are read-only and cannot be modified.

When an image is run and a container is created with the `run` command, Docker creates another layer that exists as long as the container is running. This temporary <span style = "color:lightblue">container layer</span> is read-write, but its contents, such as log files generated by an application, are deleted when the container ends.

> [!INFO]
> If a file belonging to the read-only layers is modified, it will be copied to the container layer. Future modifications will be performed on the copy of the file instead of the original file itself.

### Persistent Volumes
To retain any files stored *inside* the container, a directory inside the container can be <span style = "color:lightblue">mounted</span> (i.e., mapped). In <span style = "color:lightblue">volume mounting</span>, the container directory is mounted to a volume which is a directory under `/var/lib/docker/volumes`. In <span style = "color:lightblue">bind mounting</span>, the container directory is mounted to another directory on the host system.

```bash
docker volume create <NAME>
```

When an image is run, the `-v` option can be specified to indicate the host volume or host directory and container directory to mount.

```bash
docker run -v <VOLUME_NAME>:<PATH_INSIDE_CONTAINER> <IMAGE_NAME>
```

```bash
docker run -v <HOST_PATH>:<PATH_INSIDE_CONTAINER> <IMAGE_NAME>
```

For example, the code block below will create the volume named `data` and run the `mysql` image such that the `/var/lib/mysql` directory inside the container is **mounted** to the `data` volume on the host.

```bash
docker volume create data
docker run -v data:/var/lib/mysql mysql
```

> [!INFO]
> A volume does not need to be created before the `run` command is used. If the volume does not exist, it is created automatically by Docker.

> [!INFO]
> In newer Docker versions, the `--mount` option is recommended over the `-v` option.
> ```bash
> docker run --mount type=bind,source=/data/mysql,target=/var/lib/mysql mysql
> ```
> An example of the bind mount of a MySQL Docker image is shown.

A <span style = "color:lightblue">storage driver</span> is a Docker component that handles storage creation and management of containers. Some drivers include AUFS, ZFS, BTRFS, Device Mapper, Overlay, and Overlay2.

On the other hand, a <span style = "color:lightblue">volume driver plugin</span> handles volumes. The `--volume-driver` option can specify the volume driver to use when a container is run.